# fastlane/Fastfile

default_platform(:android)

platform :android do
  desc "Deploys a signed app bundle to the Google Play Internal track"
  lane :deploy_to_open_testing do
    # Use the `supply` action to upload the AAB to the Play Store.
    # The `aab` path is relative to the workspace root, so we use `../`
    # as the GitHub Actions job `cd`s into the 'fastlane' directory.
    supply(
      aab: "build/app/outputs/bundle/prodRelease/app-prod-release.aab",
      package_name: "com.colorrash.color_rash",
        # The `track` parameter specifies the track to which you want to deploy.
        # In this case, we are deploying to the Internal Testing track.
        # You can change this to `alpha`, `beta`, or `production` as needed.
        # The `track` parameter specifies the track to which you want to deploy.
      track: "beta",
      # `json_key` is the path to your service account key,
      # which is created by your GitHub Actions workflow.
      json_key: ENV['GOOGLE_PLAY_KEY_FILE'], # THIS IS THE CORRECTED LINE

    )

    # Note: We are not running the build command here because it's already handled
    # by the `flutter build` step in your GitHub Actions workflow.
    # The responsibility of this Fastlane lane is only the deployment.
     email(
          to: "adamtomy13@gmail.com", # <--- Add your email addresses here
          subject: "New Color Rash Android build available on open Testing track!",
          body: "A new version of Color Rash has been successfully uploaded to the Open Testing track on Google Play. You can now download and test it. link is : https://play.google.com/apps/testing/com.colorrash.color_rash}",
          # You can use the 'skip_text_attachment' option to avoid attaching the log file.
          skip_text_attachment: true
        )
  end
end